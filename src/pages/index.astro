---
import WindowLayout from "../layouts/WindowLayout.astro";
import ProfileMd from "../content/profile.md";
import { projects } from "../data/projects";

const techs = ["JavaScript", "Astro","SQL","Power BI","Excel","Git","GitHub","C"];

const techColor = (t: string) => {
  const m: Record<string, string> = {
    HTML: "#ff6b6b",
    CSS: "#4dabf7",
    JavaScript: "#ffd43b",
    TypeScript: "#3178c6",
    Astro: "#7c3aed",

    "Node.js": "#22c55e",
    Express: "#a3a3a3",

    SQL: "#38bdf8",
    MySQL: "#38bdf8",

    "Power BI": "#f59e0b",
    "PowerBI": "#f59e0b",
    Excel: "#16a34a",

    Git: "#f97316",
    GitHub: "#e5e7eb",

    C: "#93c5fd",
  };

  return m[t] ?? "#7c3aed";
};

const contact = {
  email: "janosanz04@gmail.com",
  github: "https://github.com/JanoSanz",
  linkedin: "https://www.linkedin.com/in/jano-sanz-875b9b2a5/",
  cvUrl: "/CV_Jano_Lorenzo_Sanz.pdf",
  mailTemplate:
    "mailto:janosanz04@gmail.com?subject=" +
    encodeURIComponent("Contacto desde tu portfolio") +
    "&body=" +
    encodeURIComponent(
      "Hola Jano,\n\nVi tu portfolio y me interesó...\n\n¿Podemos coordinar?\n\nGracias!"
    ),
};

---

<WindowLayout title="Portafolio">
  <div class="views hudScroll" id="views" data-view="perfil">
    <!-- PERFIL -->
    <section class="view" data-name="perfil">
      <div class="panel">
        <div class="top">
          <div class="avatar">
            <img src="/me.jpg" alt="Foto" />
          </div>

          <div class="info">
            <div class="name">Jano Lorezo Sanz</div>
            <div class="meta">Edad: 21 | Carrera: Ing. Informatica</div>

            <div class="tags">
              {techs.map((t) => (
                <span class="tag" style={`--c:${techColor(t)}`}>{t}</span>
              ))}
            </div>

            <div class="cvBtns">
              <a class="btn" href={contact.cvUrl} target="_blank">Ver CV</a>
              <a class="btn ghost" href={contact.cvUrl} download>Descargar</a>
            </div>
          </div>
        </div>

        <div class="bio">
          <div class="bioHead">
            <div class="bioTitle">Descripción / CV</div>
          </div>

          <div class="bioScroll hudScroll">
            <ProfileMd />
          </div>
        </div>
      </div>
    </section>

<!-- PROYECTOS -->
<section class="view" data-name="proyectos">
  <div class="panel panelProjects">
    <div class="head">
      <h2>Proyectos</h2>
      <p>Algunos de los proyectos que fui construyendo.</p>
    </div>

    <div class="projectsScroll">
      <div class="gridProjects">
        {projects.map((p) => (
          <article class="pCard">
            <div class="pImg">
              <img src={p.image} alt={p.title} loading="lazy" />
            </div>

            <div class="pInfo">
              <div class="pTitle">{p.title}</div>

              <div class="pTags">
                {p.tech.map((t) => (
                  <span class="tag" style={`--c:${techColor(t)}`}>{t}</span>
                ))}
              </div>

              <div class="pDesc">{p.desc}</div>

              {(p.demo || p.repo) && (
                <div class="pLinks">
                  {p.demo && (
                    <a class="btn sm" href={p.demo} target="_blank" rel="noreferrer">Demo</a>
                  )}
                  {p.repo && (
                    <a class="btn sm ghost" href={p.repo} target="_blank" rel="noreferrer">Repo</a>
                  )}
                </div>
              )}
            </div>
          </article>
        ))}
      </div>
    </div>
  </div>
</section>



<!-- CONTACTO -->
<section class="view" data-name="contacto">
  <div class="panel panelContact">
    <div class="head">
      <h2>Contacto</h2>
      <p>Si querés hablar por un proyecto o una oportunidad, acá están mis links.</p>
    </div>

    <div class="contactGrid">
      <div class="card">
        <div class="cardTitle">Email</div>
        <div class="row">
          <a class="mono" href={"mailto:" + contact.email}>{contact.email}</a>
          <button class="btn sm" type="button" data-copy={contact.email}>Copiar</button>
        </div>
        <div class="hint">Copialo rápido o abrí tu cliente de correo.</div>
      </div>

      <div class="card">
        <div class="cardTitle">Redes</div>
        <div class="links">
          <a class="link" href={contact.github} target="_blank">GitHub</a>
          <a class="link" href={contact.linkedin} target="_blank">LinkedIn</a>
        </div>
        <div class="hint">Repos y perfil profesional.</div>
      </div>

      <div class="card">
        <div class="cardTitle">CV</div>
        <div class="links">
          <a class="btn sm" href={contact.cvUrl} target="_blank">Ver CV</a>
          <a class="btn sm ghost" href={contact.cvUrl} download>Descargar</a>
        </div>
        <div class="hint">PDF directo (rápido de abrir).</div>
      </div>

      <div class="card wide">
        <div class="cardTitle">Mensaje rápido</div>
        <p class="msg">
          Hola Jano, vi tu portfolio y me interesó <span class="mono">[proyecto]</span>. ¿Podemos coordinar?
        </p>
        <div class="links">
          <a
            class="btn sm"
            href={
              `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(contact.email)}&su=${encodeURIComponent(
                "Contacto desde tu portfolio"
              )}&body=${encodeURIComponent(
                "Hola Jano,\n\nVi tu portfolio y me interesó [proyecto]. ¿Podemos coordinar?\n\nGracias!"
              )}`
            }
            target="_blank"
            rel="noreferrer"
            >
            Enviar por Gmail
          </a>
          <a
            class="btn sm ghost"
            href={
              `mailto:${contact.email}?subject=${encodeURIComponent("Contacto desde tu portfolio")}&body=${encodeURIComponent(
                "Hola Jano,\n\nVi tu portfolio y me interesó [proyecto]. ¿Podemos coordinar?\n\nGracias!"
              )}`
            }
            >
            Abrir en app
          </a>
          <button
            class="btn sm ghost"
            type="button"
            data-copy-msg="Hola Jano,\n\nVi tu portfolio y me interesó [proyecto]. ¿Podemos coordinar?\n\nGracias!"
            >
            Copiar mensaje
          </button>
        </div>
        <div class="hint">
          Gmail funciona siempre. “Abrir en app” depende de la configuración del dispositivo.
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    document.addEventListener("click", async (e) => {
      const t = e.target instanceof Element ? e.target : null;
      const btn = t ? t.closest("[data-copy]") : null;
      if (!btn) return;

      const text = btn.getAttribute("data-copy") || "";
      try {
        await navigator.clipboard.writeText(text);
        btn.textContent = "Copiado ✓";
        setTimeout(() => (btn.textContent = "Copiar"), 1200);
      } catch {
        prompt("Copiá esto:", text);
      }
    });
    const msgBtn = t ? t.closest("[data-copy-msg]") : null;
    if (msgBtn) {
      const text = msgBtn.getAttribute("data-copy-msg") || "";
      try {
        await navigator.clipboard.writeText(text);
        msgBtn.textContent = "Copiado ✓";
        setTimeout(() => (msgBtn.textContent = "Copiar mensaje"), 1200);
      } catch {
        prompt("Copiá esto:", text);
      }
      return;
    }
  </script>
</section>

  <script>
	type ViewName = "perfil" | "proyectos" | "contacto";

	const root = document.getElementById("views");
	if (!root) throw new Error("No se encontró el contenedor #views");

	const rootEl = root as HTMLElement;

	function isViewName(v: string): v is ViewName {
	return v === "perfil" || v === "proyectos" || v === "contacto";
	}

	function setView(name: ViewName) {
	rootEl.dataset.view = name;
	location.hash = name;
	}

	const initialRaw = location.hash.replace("#", "");
	if (isViewName(initialRaw)) setView(initialRaw);

	document.addEventListener("click", (e: MouseEvent) => {
	const target = e.target;
	if (!(target instanceof Element)) return;

	const el = target.closest<HTMLElement>("[data-view-link]");
	if (!el) return;

	e.preventDefault();

	const v = el.getAttribute("data-view-link") ?? "perfil";
	if (isViewName(v)) setView(v);
	});

	window.addEventListener("hashchange", () => {
	const v = location.hash.replace("#", "");
	if (isViewName(v)) setView(v);
	});

  </script>

  <style>
    /* mostrar solo la vista activa */
    .view{display:none}
    .views[data-view="perfil"] .view[data-name="perfil"],
    .views[data-view="proyectos"] .view[data-name="proyectos"],
    .views[data-view="contacto"] .view[data-name="contacto"]{
      display:block;
      height:100%;
    }

    .panel{
      height:100%;
      border:1px solid #2a2a2a;
      border-radius:14px;
      background: linear-gradient(180deg, #0f0f12, #09090c);
      padding:16px;
    }

    /* PERFIL */
    .top{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap:14px;
      padding:12px;
      border:1px solid #222;
      border-radius:12px;
      background:#0b0b0b;
      align-items:flex-start;
    }

    .avatar{
      width:140px;height:140px;
      border-radius:12px;
      overflow:hidden;
      border:1px solid #2a2a2a;
      background:#070707;
    }
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}

    .name{font-size:22px;font-weight:900;color:#f0f0f0;margin-bottom:6px}
    .meta{color:#bdbdbd;margin-bottom:10px}

    .tags{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
    .tag{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid color-mix(in srgb, var(--c) 60%, #2a2a2a);
      background: color-mix(in srgb, var(--c) 12%, #0b0b0b);
      color:#eaeaea;
      font-size:12px;
    }

    .cvBtns{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #2a2a2a;
      text-decoration:none;
      color:#eaeaea;
      background:#121216;
    }
    .btn.ghost{background:transparent}
    .btn:hover{border-color:#7c3aed}

    .bio{
      margin-top:14px;
      padding:12px;
      border:1px solid #222;
      border-radius:12px;
      background:#0b0b0b;
    }
    .bioTitle{
      font-size:12px;
      letter-spacing:2px;
      color:#dcdcdc;
      font-weight:800;
      text-transform:uppercase;
      margin-bottom:10px;
    }

  @media (max-width: 520px){
  .top{
    flex-direction:column;
    gap:12px;
  }

  .avatar{
    width:100%;
    height:140px;
  }

  .avatar img{
    width:100%;
    height:100%;
    object-fit:cover;
    border-radius:14px;
  }

  .info{
    width:100%;
  }

  .meta{
    font-size:14px;
    line-height:1.35;
  }

  .tags{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }

  .cvBtns{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }

  .cvBtns .btn{
    width:100%;
    text-align:center;
  }
}

    /* Markdown scrollable */
    .bioScroll{
      max-height: 320px;
      overflow:auto;
      padding-right:8px;
      color:#bdbdbd;
      line-height:1.65;
    }

    .bioScroll :global(h2){color:#eaeaea;margin:10px 0}
    .bioScroll :global(ul){margin:8px 0 8px 18px}
    .bioScroll :global(a){color:#c4b5fd}
	
	/* Proyectos */
    @media (max-width: 520px){
      .top{grid-template-columns: 110px 1fr}
      .avatar{width:110px;height:110px}
      .bioScroll{max-height:260px}
    }

	.head h2{margin:0 0 6px 0}
	.head p{margin:0 0 14px 0;color:#bdbdbd}

	/* mobile */
	.gridProjects{
		display:grid;
		gap:12px;
		grid-template-columns: 1fr;
		padding-top: 1vh;
	}
	
	/* PC: 2 columnas */
	@media (min-width: 820px){
	.gridProjects{
		grid-template-columns: 1fr 1fr;
	}
	}

	.pCard{
		display:flex;
		gap:12px;
		border:1px solid #222;
		border-radius:14px;
		background:#0b0b0b;
		padding:12px;
		min-height:140px;
		transition: border-color 160ms ease, transform 160ms ease, box-shadow 160ms ease;
	}

	.pCard:hover{
		border-color:#7c3aed;
		box-shadow: 0 0 0 3px rgba(124, 58, 237, .12);
		transform: translateY(-2px);
	}

	.pCard:hover{
		animation: glow 900ms ease-in-out infinite alternate;
	}

	@keyframes glow{
		from { box-shadow: 0 0 0 3px rgba(124, 58, 237, .10); }
		to   { box-shadow: 0 0 0 3px rgba(124, 58, 237, .22); }
	}


	.pImg{
		width:140px;
		height:110px;
		border-radius:12px;
		overflow:hidden;
		border:1px solid #2a2a2a;
		background:#070707;
		flex: 0 0 auto;
	}

	.pImg img{
		width:100%;
		height:100%;
		object-fit:cover;
		display:block;
	}

	.pInfo{flex:1;min-width:0}
	.pTitle{
		font-weight:900;
		color:#f0f0f0;
		margin-bottom:8px;
		font-size:16px;
	}

	.pTags{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}

	.pDesc{
		color:#bdbdbd;
		line-height:1.5;
		font-size:13px;
		display:-webkit-box;
		-webkit-line-clamp:3;
		-webkit-box-orient:vertical;
		overflow:hidden;
	}

	.pLinks{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
	.btn.sm{padding:8px 10px;font-size:12px;border-radius:10px}

	/* Panel Proyectos en columna */
	.panelProjects{
		display:flex;
		flex-direction:column;
	}

	/* Esto genera el scroll cuando hay muchas cards */
	.projectsScroll{
		flex:1;
		overflow:auto;
		padding-right:10px;
		scrollbar-width: thin;
		scrollbar-color: #2a2a2a transparent;
	}
	.projectsScroll::-webkit-scrollbar{ width: 8px; }
	.projectsScroll::-webkit-scrollbar-thumb{ background:#2a2a2a; border-radius:999px; }
	.projectsScroll::-webkit-scrollbar-thumb:hover{ background:#3a3a3a; }

	.panelProjects{
		display:flex;
		flex-direction:column;
		height:100%;
		min-height:0;
	}

  .panelProjects{
  height: 100%;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.projectsScroll{
  flex: 1;
  min-height: 0;
  overflow: auto;
}

	/* el scroll real */
	.projectsScroll{
		flex:1;
		overflow:auto;
		min-height:0;
		padding-right:10px;
	}
	/* Contacto */

	.panelContact{ height:100%; }

	.contactGrid{
		display:grid;
		gap:12px;
		grid-template-columns: 1fr;
	}

	@media (min-width: 820px){
		.contactGrid{ grid-template-columns: 1fr 1fr; }
		.wide{ grid-column: span 2; }
	}

	.card{
		border:1px solid #222;
		border-radius:14px;
		background:#0b0b0b;
		padding:14px;
	}

	.cardTitle{
		font-weight:900;
		letter-spacing:1px;
		margin-bottom:10px;
		color:#f0f0f0;
	}

	.row{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
	.links{ display:flex; gap:10px; flex-wrap:wrap; }

	.link{
		padding:10px 12px;
		border-radius:10px;
		border:1px solid #2a2a2a;
		text-decoration:none;
		color:#eaeaea;
		background:#121216;
	}
	.link:hover{ border-color:#7c3aed; }

	.hint{ margin-top:8px; color:#9c9c9c; font-size:12px; }
	.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
	.msg{ color:#bdbdbd; margin:0; line-height:1.6; }

	.panelContact a.mono{
		color:#eaeaea;
		text-decoration:none;
	}
	.panelContact a.mono:hover{
		color:#7c3aed;
		text-decoration:underline;
	}
	.panelContact a.mono:visited{
		color:#eaeaea;
	}

.hudScroll{
  overflow: auto;
  padding-right: 10px;

  scrollbar-width: thin;
  scrollbar-color: rgba(53, 45, 66, 0.55) transparent;
}

.hudScroll::-webkit-scrollbar{
  width: 10px;
}

.hudScroll::-webkit-scrollbar-track{
  background: transparent;
}

.hudScroll::-webkit-scrollbar-thumb{
  background: rgba(124, 58, 237, .35);
  border: 1px solid rgba(124, 58, 237, .55);
  border-radius: 999px;
}

.hudScroll::-webkit-scrollbar-thumb:hover{
  background: rgba(124, 58, 237, .55);
  box-shadow: 0 0 0 3px rgba(124, 58, 237, .12);
}

	</style>
</WindowLayout>
